machine:
  node:
    version: 4.2.6
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  pre:
    - ./docker-build.sh mapzen/styleguide
  post:
    - npm install -g gulp-cli && gulp build

deployment:
  production:
    branch: master
    commands:
      - gulp publish --target dev
      - gulp publish --target prod
      - ./docker-publish.sh mapzen/styleguide latest
  other:
    branch: /.*/
    commands:
      - ./docker-publish.sh mapzen/styleguide $CIRCLE_BRANCH

general:
  artifacts:
    - "dist"
